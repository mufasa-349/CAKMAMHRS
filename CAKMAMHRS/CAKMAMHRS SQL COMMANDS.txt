--SQL SCRIPTS FOR CAKMAMHRS

--CREATING TABLES

CREATE TABLE DOCTORS(
	DOCTORID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	DOCTORNAME NVARCHAR(50) NOT NULL

)

CREATE TABLE PATIENTS(
	PATIENTID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	PATIENTNAME NVARCHAR(50) NOT NULL

)

CREATE TABLE ROOMS(
	ROOMID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	ROOMCODE NVARCHAR(50) NOT NULL

)

CREATE TABLE APPOINTMENTS(
	APPOINTMENTID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	A_DATE DATETIME NOT NULL,
	ROOMID INT NOT NULL FOREIGN KEY REFERENCES ROOMS(ROOMID),
	DOCTORID INT NOT NULL FOREIGN KEY REFERENCES DOCTORS(DOCTORID),
	PATIENTID INT NOT NULL FOREIGN KEY REFERENCES PATIENTS(PATIENTID),
	[STATUS] INT

)

--INSERT INTO DOCTORS
INSERT INTO DOCTORS(DOCTORNAME)
VALUES ('MUSTO')

INSERT INTO DOCTORS(DOCTORNAME)
VALUES ('YUUZO')

INSERT INTO DOCTORS(DOCTORNAME)
VALUES ('BOZO')

--INSERT INTO PATIENTS
INSERT INTO PATIENTS(PATIENTNAME)
VALUES ('FATO')

INSERT INTO PATIENTS(PATIENTNAME)
VALUES ('NISO')

INSERT INTO PATIENTS(PATIENTNAME)
VALUES ('IBO')

--INSERT INTO DOCTORS
INSERT INTO ROOMS(ROOMCODE)
VALUES ('027')

INSERT INTO ROOMS(ROOMCODE)
VALUES ('162')

INSERT INTO ROOMS(ROOMCODE)
VALUES ('217')

--INSERT INTO APPOINTMENTS
INSERT INTO APPOINTMENTS(A_DATE,ROOMID,DOCTORID,PATIENTID,[STATUS])
VALUES(
	'2023-09-27 14:00',
	1,
	3,
	2,
	1
)

INSERT INTO APPOINTMENTS(A_DATE,ROOMID,DOCTORID,PATIENTID,[STATUS])
VALUES(
	'2023-09-14 11:00',
	2,
	1,
	3,
	1
)

INSERT INTO APPOINTMENTS(A_DATE,ROOMID,DOCTORID,PATIENTID,[STATUS])
VALUES(
	'2023-09-07 09:00',
	3,
	2,
	1,
	1
)

--CREATE VIEW STATEMENT
CREATE VIEW GETAPPOINTMENTDATA
AS 

SELECT
	A.APPOINTMENTID AS APPOINTMENTID,
	A.A_DATE AS A_DATE,
	R.ROOMCODE AS ROOM,
	D.DOCTORNAME AS DOCTORNAME,
	P.PATIENTNAME AS PATIENTNAME,
	A.STATUS AS [STATUS]

FROM APPOINTMENTS A
INNER JOIN ROOMS R ON R.ROOMID = A.ROOMID
INNER JOIN DOCTORS D ON D.DOCTORID = A.DOCTORID
INNER JOIN PATIENTS P ON P.PATIENTID = A.PATIENTID





--CREATE PROCEDURE ADDAPOOINTMENT

CREATE PROCEDURE ADDAPPOINTMENT


@A_DATE DATETIME,
@ROOMCODE NVARCHAR(50),
@DOCTORNAME NVARCHAR(50),
@PATIENTNAME NVARCHAR(50)

AS
IF NOT EXISTS(SELECT A_DATE FROM APPOINTMENTS WHERE A_DATE = @A_DATE)

	INSERT INTO PATIENTS(PATIENTNAME) VALUES(@PATIENTNAME)
	INSERT INTO DOCTORS(DOCTORNAME) VALUES(@DOCTORNAME)
	INSERT INTO ROOMS(ROOMCODE) VALUES(@ROOMCODE)
	INSERT INTO APPOINTMENTS(A_DATE, ROOMID, DOCTORID, PATIENTID, [STATUS])
	VALUES(
		@A_DATE,
		(SELECT ROOMID FROM ROOMS WHERE ROOMCODE = @ROOMCODE),
		(SELECT DOCTORID FROM DOCTORS WHERE DOCTORNAME = @DOCTORNAME),
		(SELECT PATIENTID FROM PATIENTS WHERE PATIENTNAME = @PATIENTNAME),
		1

	)
GO

--CREATE PROCEDURE UPDATEAPPOINTMENT 
CREATE PROCEDURE UPDATEAPPOINTMENT

@AppointmentID INT,
@A_Date DATETIME,
@room NVARCHAR(50),
@doctorName NVARCHAR(50),
@patientName NVARCHAR(50),
@status NVARCHAR(50)
AS
IF NOT EXISTS(SELECT * FROM DOCTORS WHERE DOCTORNAME = @doctorName)
	INSERT INTO DOCTORS (DOCTORNAME) VALUES(@doctorName)

IF NOT EXISTS(SELECT * FROM PATIENTS WHERE PATIENTNAME = @patientName)
	INSERT INTO PATIENTS (PATIENTNAME) VALUES(@patientName)

IF NOT EXISTS(SELECT * FROM ROOMS WHERE ROOMCODE = @room)
	INSERT INTO ROOMS (ROOMCODE) VALUES(@room)

UPDATE APPOINTMENTS SET
A_DATE = @A_Date,
DOCTORID = (SELECT DOCTORID FROM DOCTORS WHERE DOCTORNAME = @doctorName),
PATIENTID = (SELECT PATIENTID FROM PATIENTS WHERE PATIENTNAME = @patientName),
ROOMID = (SELECT ROOMID FROM ROOMS WHERE ROOMCODE = @room)

WHERE APPOINTMENTID = @AppointmentID

GO



--CREATE PROCEDURE DELETEAPPOINTMENT

CREATE PROCEDURE DELETEAPPO
@AppointmentID int
AS

DELETE FROM APPOINTMENTS WHERE APPOINTMENTID = @AppointmentID

GO


--CREATE TABLE DATETABLE
CREATE TABLE DATETABLE(
	ID INT IDENTITY(1,1) PRIMARY KEY,
	YIL NVARCHAR(50),
	AY NVARCHAR(50),
	GUN NVARCHAR(50),
	[09.00] NVARCHAR(50),
	[10.00] NVARCHAR(50),
	[11.00] NVARCHAR(50),
	[12.00] NVARCHAR(50),
	[13.00] NVARCHAR(50),
	[14.00] NVARCHAR(50),
	[15.00] NVARCHAR(50)
)


--INSERT VALUES DATETABLE
INSERT INTO DATETABLE(YIL,AY)
VALUES(
	'2023',
	'09'
)

INSERT INTO DATETABLE(YIL,AY)
VALUES(
	'2023',
	'09'
)

INSERT INTO DATETABLE(YIL,AY)
VALUES(
	'2023',
	'09'
)

INSERT INTO DATETABLE(YIL,AY)
VALUES(
	'2023',
	'09'
)

INSERT INTO DATETABLE(YIL,AY)
VALUES(
	'2023',
	'09'
)


--ADDING MISSING INFORMATION 'GUN'
UPDATE  DATETABLE
SET GUN= '23'
WHERE ID = 1

UPDATE  DATETABLE
SET GUN= '24'
WHERE ID = 2

UPDATE  DATETABLE
SET GUN= '25'
WHERE ID = 3

UPDATE  DATETABLE
SET GUN= '26'
WHERE ID = 4


UPDATE  DATETABLE
SET GUN= '27'
WHERE ID = 5


------------TEST--------
